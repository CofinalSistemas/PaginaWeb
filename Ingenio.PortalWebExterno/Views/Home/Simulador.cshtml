@model Ingenio.PortalWebExterno.Models.SimuladorCredito


@using (Html.BeginForm())
{
    <div class="form-horizontal">
        <h4 class="tituleAnimation">Simulador</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Capital, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-4">
                @Html.EditorFor(model => model.Capital, new { htmlAttributes = new { @class = "form-control", @id = "monto_capital", @placeholder = "Ingresar un valor de 100.000 a 100'000'000.000" } })
                @Html.ValidationMessageFor(model => model.Capital, "", new { @class = "text-danger" })
            </div>
        </div>
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Periodo, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-4">
                @Html.DropDownListFor(model => model.Periodo, new List<SelectListItem>
                {
                   new SelectListItem { Text = "90", Value = "90" },
                   new SelectListItem { Text = "120", Value = "120" },
                   new SelectListItem { Text = "150", Value = "150" },
                   new SelectListItem { Text = "180", Value = "180" },
                   new SelectListItem { Text = "210", Value = "210" },
                   new SelectListItem { Text = "240", Value = "240" },
                   new SelectListItem { Text = "270", Value = "270" },
                   new SelectListItem { Text = "300", Value = "300" },
                   new SelectListItem { Text = "330", Value = "330" },
                   new SelectListItem { Text = "360", Value = "360" },

                }, "Seleccionar")
                @Html.ValidationMessageFor(model => model.Periodo, "", new { @class = "text-danger" })
            </div>
        </div>

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Periodo_Ahorro, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-4">
                @Html.DropDownListFor(model => model.Periodo_Ahorro, new List<SelectListItem>
                {
                   new SelectListItem { Text = "Al Vencimiento", Value = "Al Vencimiento" },
                   new SelectListItem { Text = "Mensual", Value = "Mensual" },
                }, "Seleccionar")
                @Html.ValidationMessageFor(model => model.Periodo_Ahorro, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-4">
                <input type="submit" value="Enviar" class="myButtons" />
                <a href="/Home/Simulador" class="myButtons centerSpan">Resetear</a>
            </div>
        </div>
    </div>
}

@{
    if (IsPost)
    {

        if (Model.Capital >= 500000 & Model.Capital <= 1000000000)
        {
            //double tasa_nominal = Math.((1 + Model.Tasa_Efectiva),(1/ @Model.Periodo_Ahorro) * @Model.Periodo_Ahorro;

            //decimal prueba = Math.Pow((1m + (Model.Tasa_Efectiva(Model.Periodo) / 100m)), (1m / 12m)) * 12m;

            // (((1+0.14)^(1/12)-1)*12)*100
            // Math.Truncate(550.847457 * 100) / 100
            double tasa_nomial,interes,interesTotales;
            decimal tasa_efectivas = (1 + Model.Tasa_Efectiva(Model.Periodo) / 100);
            double mes = double.Parse(Model.Periodo) / 30;

            if (@Model.Periodo_Ahorro == "Al Vencimiento")
            {
                tasa_nomial =
                    Math.Truncate((
                    (Math.Pow(Decimal.ToDouble(tasa_efectivas), 1 / (12 / mes)) - 1) * (12 / mes))
                    * 100 * 100) / 100;

                interes = (tasa_nomial / 100 * Model.Capital) / 12;
                interesTotales = (tasa_nomial / 100 * Model.Capital);

            }
            else
            {
                tasa_nomial =
                    Math.Truncate((
                    (Math.Pow(Decimal.ToDouble(tasa_efectivas), 1 / (12 / 1)) - 1) * (12 / 1))
                    * 100 * 100) / 100;

                interes = (tasa_nomial / 100 * Model.Capital) / 12;
                interesTotales = (tasa_nomial / 100 * Model.Capital);
            }


            @*<p>La tasa de Interes es: @Model.Tasa_Efectiva(num)</p>*@
            <p>El Capital es: @Model.Capital</p>
            <p>Periodo en dias: @Model.Periodo </p>
            <p>Periodo pago de Intereses: @Model.Periodo_Ahorro</p>
            @*<p>Meses = @mes </p>*@
            <p>
                No. de pagos:
                @if (@Model.Periodo_Ahorro == "Al Vencimiento")
                {
                    <span>1</span>;
                }
                else
                {
                    <span>@mes</span>
                }
            </p>
            <p>La tasa efectiva anual:  @Model.Tasa_Efectiva(Model.Periodo) %</p>
            <p>Tasa nominal = @String.Format("{0:0,0.0}", tasa_nomial) %</p>
            <p>Interes del Periodo: $ @String.Format("{0:0,0.0}", interes) </p>
            <p>Total Interés Plazo: $ @String.Format("{0:0,0.0}", interesTotales) </p>
            <p>Rte Funete : $ 0 </p>
            <p>Total de Rte Funete : $0 </p>
            <p>Valor a Recibir en el Período:$ @String.Format("{0:0,0.0}", interes) </p>
            <p>Valor a Recibir en Total: $ @String.Format("{0:0,0.0}", interesTotales + Model.Capital) </p>


        }
    }
    else
    {
        <p>Aqui  apenas entro</p>
    }
    @*Model.Capital = "3000";
        <p> El nombre es: @Model.Capital</p>*@
}
<div>
    @Html.ActionLink("home", "simulador")
</div>

<script>
    const capital = document.getElementById('monto_capital');
    function isCharacterALetter(char) {
        return (/[a-zA-Z]/).test(char)
    }

    capital.addEventListener('input', (letra) => {
        const valor = letra.target.value;
        console.log(`El valor es: ${valor.charAt(valor.length - 1)}`)
        //console.log(letra.target.value[1])
        if (isCharacterALetter(valor.charAt(valor.length - 1))) {
            console.log("Borro");
            setTimeout(() => {
                capital.value = capital.value.substring(0, capital.value.length - 1);
            }, "100")
        }
    });

    //$("#monto_capital").on({
    //    "focus": function (event) {
    //        $(event.target).select();
    //    },
    //    "keyup": function (event) {
    //        $(event.target).val(function (index, value) {
    //            return value.replace(/\D/g, "")
    //                .replace(/([0-9])([0-9]{2})$/, '$1.$2')
    //                .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",");
    //        });
    //    }
    //});

</script>